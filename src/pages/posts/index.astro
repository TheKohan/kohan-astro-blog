---
import { getCollection } from "astro:content";
import LandingPage from "@layouts/landing-page.astro";
import { Image } from "@astrojs/image/components";
import { Icon } from "astro-icon";
import { DateTime } from "luxon";

const posts = (await getCollection("posts")).sort(
  (a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime()
);

const latestPosts = posts.slice(0, 4);
---

<LandingPage title="Posts">
  <div class="flex flex-col gap-8 lg:flex-row">
    <div class="flex basis-3/4 flex-col gap-8">
      {
        posts.map((post) => (
          <article class="flex flex-col rounded-2xl bg-slate-800 ">
            <a
              href={"/posts/" + post.slug}
              class="relative h-48 cursor-pointer overflow-hidden text-center"
            >
              <Image
                class:list={"rounded-2xl w-[100%] h-[100%] object-cover"}
                width={450}
                height={450}
                format={"jpg"}
                alt={post.data.image.alt}
                src={post.data.image.src}
              />
            </a>
            <div class="flex flex-1 flex-col gap-4 px-8 pb-8 pt-6">
              <div class="text-kohan-300/80 flex gap-4 text-sm">
                <div class="flex items-center gap-2">
                  <Icon
                    class="text-kohan-500 h-6 w-6 shrink-0"
                    name="calendar"
                  />
                  <div>
                    {DateTime.fromJSDate(post.data.publishDate).toFormat(
                      "MMM dd, yyyy"
                    )}
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-8">
                <h2 class="dark:text-kohan-300 text-2xl">
                  <a href={"/posts/" + post.slug}>{post.data.title}</a>
                </h2>
                <p>{post.data.description}</p>
              </div>
            </div>
          </article>
        ))
      }
    </div>
    <div class="mb-4 flex flex-col gap-4">
      <h2
        class="before:border-red text-2xl before:border-2 dark:text-kohan-300"
      >
        Latest articles
      </h2>
      <div class="flex flex-col gap-4">
        {
          latestPosts.map((post) => (
            <div class="items-top flex gap-4">
              <Image
                class:list={
                  "basis-1/3 rounded-2xl w-[100%] h-[100%] object-cover"
                }
                width={75}
                height={75}
                format={"jpg"}
                alt={post.data.image.alt}
                src={post.data.image.src}
              />
              <div class="flex basis-2/3 flex-col gap-2">
                <a href={"/posts/" + post.slug}>
                  <h3 class="dark:text-kohan-300 text-xl">{post.data.title}</h3>
                </a>
                <p class="dark:text-kohan-300/80 text-sm">
                  {DateTime.fromJSDate(post.data.publishDate).toFormat(
                    "MMM dd, yyyy"
                  )}
                </p>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</LandingPage>
